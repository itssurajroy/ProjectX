rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Admins collection (protected)
    match /adminRoles/{userId} {
      allow read, write: if request.auth != null && 
        (request.auth.uid == userId || 
         exists(/databases/$(database)/documents/adminRoles/$(request.auth.uid)) && 
         get(/databases/$(database)/documents/adminRoles/$(request.auth.uid)).data.role in ["superadmin", "admin"]);
    }

    // Only superadmin can create/delete roles
    match /adminRoles/{userId} {
      allow create, delete: if request.auth != null && 
        exists(/databases/$(database)/documents/adminRoles/$(request.auth.uid)) &&
        get(/databases/$(database)/documents/adminRoles/$(request.auth.uid)).data.role == "superadmin";
    }

    // Rest of your rules...
    match /{document=**} {
      allow read, write: if true; // Keep open for now (or tighten later)
    }
  }
}
